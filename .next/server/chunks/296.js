exports.id=296,exports.ids=[296],exports.modules={2213:e=>{function webpackEmptyContext(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id=2213,e.exports=webpackEmptyContext},6883:(e,t,r)=>{"use strict";r.d(t,{l:()=>useAddressAutocomplete});var a=r(9885);function useAddressAutocomplete(e){let[t,r]=(0,a.useState)([]),[o,s]=(0,a.useState)(!1),[i,n]=(0,a.useState)(null),d=(0,a.useRef)(null),c=(0,a.useRef)(null),l=(0,a.useCallback)(async e=>{if(!e.trim()){r([]),s(!1),n(null);return}c.current&&c.current.abort();let t=new AbortController;c.current=t,s(!0),n(null);try{let a=await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&countrycodes=ph&format=json&limit=10&addressdetails=1`,{method:"GET",headers:{"User-Agent":"WhitelabelDeliveryApp/1.0",Accept:"application/json"},signal:t.signal});if(!a.ok)throw Error(`API request failed: ${a.status}`);let o=await a.json();if(t.signal.aborted)return;if(!Array.isArray(o)){console.error("Nominatim API returned non-array response:",o),n("Invalid response from address service"),r([]);return}let s=o.map(e=>({display_name:e.display_name,place_id:e.place_id,lat:e.lat,lon:e.lon,type:e.type||"",importance:e.importance,address:{road:e.address?.road,house_number:e.address?.house_number,suburb:e.address?.suburb,village:e.address?.village,barangay:e.address?.barangay||e.address?.suburb,city:e.address?.city,town:e.address?.town,municipality:e.address?.municipality,state:e.address?.state,province:e.address?.province||e.address?.state,postcode:e.address?.postcode,country:e.address?.country,neighbourhood:e.address?.neighbourhood,quarter:e.address?.quarter,amenity:e.address?.amenity,shop:e.address?.shop,tourism:e.address?.tourism}}));s.sort((e,t)=>{if(e.importance&&t.importance)return t.importance-e.importance;let r=!!e.address.house_number,a=!!t.address.house_number;if(r!==a)return r?-1:1;let o=!!e.address.road,s=!!t.address.road;return o!==s?o?-1:1:0}),r(s)}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;console.error("Error fetching address suggestions:",e),e instanceof TypeError&&e.message.includes("fetch")?n("Network error. Please check your connection and try again."):e instanceof Error?n(`Failed to fetch address suggestions: ${e.message}. Please try again or enter address manually.`):n("Failed to fetch address suggestions. Please try again or enter address manually."),r([])}finally{t.signal.aborted||s(!1)}},[]);return(0,a.useEffect)(()=>{if(d.current&&clearTimeout(d.current),e.trim().length<3){r([]),s(!1);return}return d.current=setTimeout(()=>{l(e)},500),()=>{d.current&&clearTimeout(d.current),c.current&&c.current.abort()}},[e,l]),(0,a.useEffect)(()=>()=>{c.current&&c.current.abort()},[]),{suggestions:t,loading:o,error:i,clearSuggestions:()=>r([])}}},9231:(e,t,r)=>{"use strict";r.d(t,{L:()=>useCategories});var a=r(9885),o=r(5413);let useCategories=()=>{let[e,t]=(0,a.useState)([]),[r,s]=(0,a.useState)(!0),[i,n]=(0,a.useState)(null),fetchCategories=async()=>{try{s(!0);let{data:e,error:r}=await o.O.from("categories").select("*").eq("active",!0).order("sort_order",{ascending:!0});if(r)throw r;t(e||[]),n(null)}catch(e){console.error("Error fetching categories:",e),n(e instanceof Error?e.message:"Failed to fetch categories")}finally{s(!1)}},addCategory=async e=>{try{let{data:t,error:r}=await o.O.from("categories").insert({id:e.id,name:e.name,icon:e.icon,sort_order:e.sort_order,active:e.active}).select().single();if(r)throw r;return await fetchCategories(),t}catch(e){throw console.error("Error adding category:",e),e}},updateCategory=async(e,t)=>{try{let{error:r}=await o.O.from("categories").update({name:t.name,icon:t.icon,sort_order:t.sort_order,active:t.active}).eq("id",e);if(r)throw r;await fetchCategories()}catch(e){throw console.error("Error updating category:",e),e}},deleteCategory=async e=>{try{let{data:t,error:r}=await o.O.from("menu_items").select("id").eq("category",e).limit(1);if(r)throw r;if(t&&t.length>0)throw Error("Cannot delete category that contains menu items. Please move or delete the items first.");let{error:a}=await o.O.from("categories").delete().eq("id",e);if(a)throw a;await fetchCategories()}catch(e){throw console.error("Error deleting category:",e),e}},reorderCategories=async e=>{try{let t=e.map((e,t)=>({id:e.id,sort_order:t+1}));for(let e of t)await o.O.from("categories").update({sort_order:e.sort_order}).eq("id",e.id);await fetchCategories()}catch(e){throw console.error("Error reordering categories:",e),e}};return(0,a.useEffect)(()=>{fetchCategories()},[]),{categories:e,loading:r,error:i,addCategory,updateCategory,deleteCategory,reorderCategories,refetch:fetchCategories}}},4556:(e,t,r)=>{"use strict";r.d(t,{H:()=>useMenu});var a=r(9885),o=r(5413);let useMenu=()=>{let[e,t]=(0,a.useState)([]),[r,s]=(0,a.useState)(!0),[i,n]=(0,a.useState)(null),fetchMenuItems=async()=>{try{s(!0);let{data:e,error:r}=await o.O.from("menu_items").select(`
          *,
          variations (*),
          add_ons (*)
        `).order("created_at",{ascending:!0});if(r)throw r;let a=e?.map(e=>{let t=new Date,r=e.discount_start_date?new Date(e.discount_start_date):null,a=e.discount_end_date?new Date(e.discount_end_date):null,o=e.discount_active&&(!r||t>=r)&&(!a||t<=a),s=o&&e.discount_price?e.discount_price:e.base_price;return{id:e.id,name:e.name,description:e.description,basePrice:e.base_price,category:e.category,popular:e.popular,available:e.available??!0,image:e.image_url||void 0,discountPrice:e.discount_price||void 0,discountStartDate:e.discount_start_date||void 0,discountEndDate:e.discount_end_date||void 0,discountActive:e.discount_active||!1,effectivePrice:s,isOnDiscount:o,variations:e.variations?.map(e=>({id:e.id,name:e.name,price:e.price}))||[],addOns:e.add_ons?.map(e=>({id:e.id,name:e.name,price:e.price,category:e.category}))||[]}})||[];t(a),n(null)}catch(e){console.error("Error fetching menu items:",e),n(e instanceof Error?e.message:"Failed to fetch menu items")}finally{s(!1)}},addMenuItem=async e=>{try{let{data:t,error:r}=await o.O.from("menu_items").insert({name:e.name,description:e.description,base_price:e.basePrice,category:e.category,popular:e.popular||!1,available:e.available??!0,image_url:e.image||null,discount_price:e.discountPrice||null,discount_start_date:e.discountStartDate||null,discount_end_date:e.discountEndDate||null,discount_active:e.discountActive||!1}).select().single();if(r)throw r;if(e.variations&&e.variations.length>0){let{error:r}=await o.O.from("variations").insert(e.variations.map(e=>({menu_item_id:t.id,name:e.name,price:e.price})));if(r)throw r}if(e.addOns&&e.addOns.length>0){let{error:r}=await o.O.from("add_ons").insert(e.addOns.map(e=>({menu_item_id:t.id,name:e.name,price:e.price,category:e.category})));if(r)throw r}return await fetchMenuItems(),t}catch(e){throw console.error("Error adding menu item:",e),e}},updateMenuItem=async(e,t)=>{try{let{error:r}=await o.O.from("menu_items").update({name:t.name,description:t.description,base_price:t.basePrice,category:t.category,popular:t.popular,available:t.available,image_url:t.image||null,discount_price:t.discountPrice||null,discount_start_date:t.discountStartDate||null,discount_end_date:t.discountEndDate||null,discount_active:t.discountActive}).eq("id",e);if(r)throw r;if(await o.O.from("variations").delete().eq("menu_item_id",e),await o.O.from("add_ons").delete().eq("menu_item_id",e),t.variations&&t.variations.length>0){let{error:r}=await o.O.from("variations").insert(t.variations.map(t=>({menu_item_id:e,name:t.name,price:t.price})));if(r)throw r}if(t.addOns&&t.addOns.length>0){let{error:r}=await o.O.from("add_ons").insert(t.addOns.map(t=>({menu_item_id:e,name:t.name,price:t.price,category:t.category})));if(r)throw r}await fetchMenuItems()}catch(e){throw console.error("Error updating menu item:",e),e}},deleteMenuItem=async e=>{try{let{error:t}=await o.O.from("menu_items").delete().eq("id",e);if(t)throw t;await fetchMenuItems()}catch(e){throw console.error("Error deleting menu item:",e),e}};return(0,a.useEffect)(()=>{fetchMenuItems()},[]),{menuItems:e,loading:r,error:i,addMenuItem,updateMenuItem,deleteMenuItem,refetch:fetchMenuItems}}},1463:(e,t,r)=>{"use strict";r.d(t,{y:()=>useOrders});var a=r(9885),o=r(5413),s=r(2054),i=r(7739);let useOrders=()=>{let[e,t]=(0,a.useState)([]),[r,n]=(0,a.useState)(!0),[d,c]=(0,a.useState)(null),l=(0,a.useRef)(null),u=(0,a.useRef)(void 0),{siteSettings:m}=(0,i.h)(),h=(0,s.lN)(m),normalizePhoneNumber=e=>{if(!e)return;let t=e.trim();if(!t)return;let r=t.replace(/\D/g,"");if(r)return r.startsWith("63")?`+${r}`:r.startsWith("0")?`+63${r.slice(1)}`:r.startsWith("9")?`+63${r}`:`+63${r}`},p=(0,a.useCallback)(async e=>{try{n(!0),c(null);let r=new URLSearchParams;e?.status&&r.append("status",e.status),e?.service_type&&r.append("service_type",e.service_type),e?.date_from&&r.append("date_from",e.date_from),e?.date_to&&r.append("date_to",e.date_to),e?.search&&r.append("search",e.search);let a=r.toString(),o=`/api/orders${a?`?${a}`:""}`,s=await fetch(o,{headers:{}});if(!s.ok){let e=await s.json().catch(()=>({error:"Failed to fetch orders"}));throw Error(e.error||"Failed to fetch orders")}let i=await s.json();t(i.orders||[]),u.current=e}catch(e){console.error("Error fetching orders:",e),c(e instanceof Error?e.message:"Failed to fetch orders"),t([])}finally{n(!1)}},[]),fetchOrderById=async e=>{try{let t=await fetch(`/api/orders/${e}`,{headers:{}});if(!t.ok){if(404===t.status)return null;let e=await t.json().catch(()=>({error:"Failed to fetch order"}));throw Error(e.error||"Failed to fetch order")}let r=await t.json();return r.order||null}catch(e){throw console.error("Error fetching order:",e),e}},createOrder=async(e,t,r,a,o,i,n)=>{try{let d=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cartItems:e,customerName:t,contactNumber:r,serviceType:a,paymentMethod:o,total:i,options:n})});if(!d.ok){let e=await d.json().catch(()=>({error:"Failed to create order"}));throw Error(e.error||"Failed to create order")}let c=await d.json(),l=c.order;if("delivery"===a&&n?.lalamoveQuotationId&&h)try{let e=normalizePhoneNumber(r)||r,a=await (0,s.io)(n.lalamoveQuotationId,t,e,h,{orderId:l.id,deliveryAddress:n?.address,deliveryLat:n?.deliveryLat,deliveryLng:n?.deliveryLng});a&&(await fetch(`/api/orders/${l.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:l.status,lalamove_order_id:a.orderId,lalamove_status:a.status,lalamove_tracking_url:a.shareLink})}),l={...l,lalamove_order_id:a.orderId,lalamove_status:a.status,lalamove_tracking_url:a.shareLink})}catch(e){console.error("Failed to create Lalamove order:",e)}return await p(u.current),l}catch(e){throw console.error("Error creating order:",e),e}},updateOrderStatus=async(e,t)=>{try{let r=await fetch(`/api/orders/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(!r.ok){let e=await r.json().catch(()=>({error:"Failed to update order"}));throw Error(e.error||"Failed to update order")}p(u.current).catch(e=>{console.error("Error refreshing orders after update:",e)})}catch(e){throw console.error("Error updating order status:",e),e}},bulkUpdateStatus=async(e,t)=>{try{let r=await fetch("/api/orders/bulk",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e,status:t})});if(!r.ok){let e=await r.json().catch(()=>({error:"Failed to update orders"}));throw Error(e.error||"Failed to update orders")}p(u.current).catch(e=>{console.error("Error refreshing orders after bulk update:",e)})}catch(e){throw console.error("Error bulk updating order status:",e),e}},getOrderStats=async()=>{try{let e=await fetch("/api/orders/stats",{headers:{}});if(!e.ok){let t=await e.json().catch(()=>({error:"Failed to fetch stats"}));throw Error(t.error||"Failed to fetch stats")}let t=await e.json();return t.stats}catch(e){throw console.error("Error fetching order stats:",e),e}};return(0,a.useEffect)(()=>{let e=!0;p();let t=o.O.channel("orders-changes").on("postgres_changes",{event:"*",schema:"public",table:"orders"},async t=>{e&&(console.log("Order change received:",t.eventType,t.new),u.current?await p(u.current):await p())}).on("postgres_changes",{event:"*",schema:"public",table:"order_items"},async t=>{e&&(console.log("Order item change received:",t.eventType),u.current?await p(u.current):await p())}).subscribe(e=>{console.log("Subscription status:",e)});return l.current=t,()=>{e=!1,l.current&&(o.O.removeChannel(l.current),l.current=null)}},[]),{orders:e,loading:r,error:d,fetchOrders:p,fetchOrderById,createOrder,updateOrderStatus,bulkUpdateStatus,getOrderStats,refetch:()=>p(u.current)}}},7918:(e,t,r)=>{"use strict";r.d(t,{E:()=>usePaymentMethods});var a=r(9885),o=r(5413);let usePaymentMethods=()=>{let[e,t]=(0,a.useState)([]),[r,s]=(0,a.useState)(!0),[i,n]=(0,a.useState)(null),fetchPaymentMethods=async()=>{try{s(!0);let{data:e,error:r}=await o.O.from("payment_methods").select("*").eq("active",!0).order("sort_order",{ascending:!0});if(r)throw r;t(e||[]),n(null)}catch(e){console.error("Error fetching payment methods:",e),n(e instanceof Error?e.message:"Failed to fetch payment methods")}finally{s(!1)}},fetchAllPaymentMethods=async()=>{try{s(!0);let{data:e,error:r}=await o.O.from("payment_methods").select("*").order("sort_order",{ascending:!0});if(r)throw r;t(e||[]),n(null)}catch(e){console.error("Error fetching all payment methods:",e),n(e instanceof Error?e.message:"Failed to fetch payment methods")}finally{s(!1)}},addPaymentMethod=async e=>{try{let{data:t,error:r}=await o.O.from("payment_methods").insert({id:e.id,name:e.name,account_number:e.account_number,account_name:e.account_name,qr_code_url:e.qr_code_url,active:e.active,sort_order:e.sort_order}).select().single();if(r)throw r;return await fetchAllPaymentMethods(),t}catch(e){throw console.error("Error adding payment method:",e),e}},updatePaymentMethod=async(e,t)=>{try{let{error:r}=await o.O.from("payment_methods").update({name:t.name,account_number:t.account_number,account_name:t.account_name,qr_code_url:t.qr_code_url,active:t.active,sort_order:t.sort_order}).eq("id",e);if(r)throw r;await fetchAllPaymentMethods()}catch(e){throw console.error("Error updating payment method:",e),e}},deletePaymentMethod=async e=>{try{let{error:t}=await o.O.from("payment_methods").delete().eq("id",e);if(t)throw t;await fetchAllPaymentMethods()}catch(e){throw console.error("Error deleting payment method:",e),e}},reorderPaymentMethods=async e=>{try{let t=e.map((e,t)=>({id:e.id,sort_order:t+1}));for(let e of t)await o.O.from("payment_methods").update({sort_order:e.sort_order}).eq("id",e.id);await fetchAllPaymentMethods()}catch(e){throw console.error("Error reordering payment methods:",e),e}};return(0,a.useEffect)(()=>{fetchPaymentMethods()},[]),{paymentMethods:e,loading:r,error:i,addPaymentMethod,updatePaymentMethod,deletePaymentMethod,reorderPaymentMethods,refetch:fetchPaymentMethods,refetchAll:fetchAllPaymentMethods}}},7739:(e,t,r)=>{"use strict";r.d(t,{h:()=>useSiteSettings});var a=r(9885),o=r(5413);let useSiteSettings=()=>{let[e,t]=(0,a.useState)(null),[r,s]=(0,a.useState)(!0),[i,n]=(0,a.useState)(null),fetchSiteSettings=async()=>{try{s(!0),n(null);let{data:e,error:r}=await o.O.from("site_settings").select("*").order("id");if(r)throw r;let a={};(e||[]).forEach(e=>{a[e.id]=e.value});let getValue=(e,t="")=>a[e]??t,i={site_name:getValue("site_name","Beracah Cafe"),site_logo:getValue("site_logo",""),site_description:getValue("site_description",""),currency:getValue("currency","PHP"),currency_code:getValue("currency_code","PHP"),lalamove_market:getValue("lalamove_market",""),lalamove_service_type:getValue("lalamove_service_type",""),lalamove_sandbox:getValue("lalamove_sandbox","true"),lalamove_api_key:getValue("lalamove_api_key",""),lalamove_api_secret:getValue("lalamove_api_secret",""),lalamove_store_name:getValue("lalamove_store_name",""),lalamove_store_phone:getValue("lalamove_store_phone",""),lalamove_store_address:getValue("lalamove_store_address",""),lalamove_store_latitude:getValue("lalamove_store_latitude",""),lalamove_store_longitude:getValue("lalamove_store_longitude","")};t(i)}catch(e){console.error("Error fetching site settings:",e),n(e instanceof Error?e.message:"Failed to fetch site settings")}finally{s(!1)}},updateSiteSetting=async(e,t)=>{try{n(null);let{error:r}=await o.O.from("site_settings").update({value:t}).eq("id",e);if(r)throw r;await fetchSiteSettings()}catch(e){throw console.error("Error updating site setting:",e),n(e instanceof Error?e.message:"Failed to update site setting"),e}},updateSiteSettings=async e=>{try{n(null);let t=Object.entries(e).map(([e,t])=>o.O.from("site_settings").update({value:t}).eq("id",e)),r=await Promise.all(t),a=r.filter(e=>e.error);if(a.length>0)throw Error("Some updates failed");await fetchSiteSettings()}catch(e){throw console.error("Error updating site settings:",e),n(e instanceof Error?e.message:"Failed to update site settings"),e}};return(0,a.useEffect)(()=>{fetchSiteSettings()},[]),{siteSettings:e,loading:r,error:i,updateSiteSetting,updateSiteSettings,refetch:fetchSiteSettings}}},2054:(e,t,r)=>{"use strict";r.d(t,{$Y:()=>fetchDeliveryQuotation,io:()=>createDeliveryOrder,lN:()=>buildLalamoveConfig});let getProxyBase=()=>"/api/lalamove",buildFunctionUrl=e=>{let t=getProxyBase(),r=requireSupabaseKey(),a=e.startsWith("/")?e:`/${e}`,o=t.replace(/\/$/,"");return`${o}${a}?apikey=${encodeURIComponent(r)}`},a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlud2F6dGhwc3FtamRncWloeHVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4Njg1MDYsImV4cCI6MjA3OTQ0NDUwNn0.F0bbR4I8dMhjhlNvTdTp3nScoWS5mHVdq85IdB7XeRQ",requireSupabaseKey=()=>{if(!a)throw Error("Missing NEXT_PUBLIC_SUPABASE_ANON_KEY; needed for proxy authentication");return a},buildProxyHeaders=()=>{let e=requireSupabaseKey();return{"Content-Type":"application/json",Authorization:`Bearer ${e}`,apikey:e}},ensureSuccess=async e=>{if(e.ok)return e.json();let t=await e.text();throw Error(t||"Delivery proxy request failed")},readEnvNumber=e=>{if(!e)return;let t=Number(e);return Number.isFinite(t)?t:void 0},buildLalamoveConfig=e=>{if(!e)return null;let t=e.lalamove_market?.trim(),r=e.lalamove_service_type?.trim(),a=e.lalamove_store_name?.trim(),o=e.lalamove_store_phone?.trim(),s=e.lalamove_store_address?.trim(),i=readEnvNumber(e.lalamove_store_latitude??void 0),n=readEnvNumber(e.lalamove_store_longitude??void 0),d=e.lalamove_sandbox?.trim().toLowerCase()!=="false";return t&&r&&a&&o&&s&&void 0!==i&&void 0!==n?{market:t,serviceType:r,sandbox:void 0===d||d,storeName:a,storePhone:o,storeAddress:s,storeLatitude:i,storeLongitude:n}:null},fetchDeliveryQuotation=async(e,t,r)=>{let a=await fetch(buildFunctionUrl("/quote"),{method:"POST",headers:buildProxyHeaders(),body:JSON.stringify({deliveryAddress:e,deliveryLat:t.lat,deliveryLng:t.lng,market:r.market,serviceType:r.serviceType,sandbox:r.sandbox,storeName:r.storeName,storePhone:r.storePhone,storeAddress:r.storeAddress,storeLatitude:r.storeLatitude,storeLongitude:r.storeLongitude})}),o=await ensureSuccess(a);return{quotationId:o.quotationId,price:Number(o.price),currency:o.currency,expiresAt:new Date(o.expiresAt)}},createDeliveryOrder=async(e,t,r,a,o)=>{let s=await fetch(buildFunctionUrl("/order"),{method:"POST",headers:buildProxyHeaders(),body:JSON.stringify({quotationId:e,recipientName:t,recipientPhone:r,market:a.market,sandbox:a.sandbox,storeName:a.storeName,storePhone:a.storePhone,metadata:o})}),i=await ensureSuccess(s);return{orderId:i.orderId,status:i.status,shareLink:i.shareLink,driverId:i.driverId}}},5413:(e,t,r)=>{"use strict";r.d(t,{O:()=>i});var a=r(2730);let o="https://inwazthpsqmjdgqihxuq.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlud2F6dGhwc3FtamRncWloeHVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4Njg1MDYsImV4cCI6MjA3OTQ0NDUwNn0.F0bbR4I8dMhjhlNvTdTp3nScoWS5mHVdq85IdB7XeRQ";if(!o||!s)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY");let i=(0,a.createClient)(o,s)}};